"use strict";var P=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var K=(t,e)=>{for(var i in e)P(t,i,{get:e[i],enumerable:!0})},z=(t,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of V(e))!U.call(t,a)&&a!==i&&P(t,a,{get:()=>e[a],enumerable:!(o=G(e,a))||o.enumerable});return t};var q=t=>z(P({},"__esModule",{value:!0}),t);var pe={};K(pe,{default:()=>A});module.exports=q(pe);var h=require("obsidian");var g=require("obsidian");var O="https://api.ouraring.com/v2",M=class{constructor(){this.name="oura",this.displayName="Oura Ring"}async fetchBiometricData(t){let e=new Date().toISOString().split("T")[0],i=new Date(Date.now()-864e5).toISOString().split("T")[0],[o,a]=await Promise.all([this.fetchSleepData(t,i,e),this.fetchReadinessData(t,i,e)]);return this.parseBiometricData(o,a)}async validateToken(t){try{return(await fetch(`${O}/usercollection/personal_info`,{headers:{Authorization:`Bearer ${t}`}})).ok}catch{return!1}}async fetchSleepData(t,e,i){let o=`${O}/usercollection/daily_sleep?start_date=${e}&end_date=${i}`,a=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`Oura API error: HTTP ${a.status}`);return(await a.json()).data||[]}async fetchReadinessData(t,e,i){let o=`${O}/usercollection/daily_readiness?start_date=${e}&end_date=${i}`,a=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`Oura API error: HTTP ${a.status}`);return(await a.json()).data||[]}parseBiometricData(t,e){let i=t[t.length-1],o=e[e.length-1];return{sleepScore:i?.score??null,readinessScore:o?.score??null,hrvBalance:o?.contributors?.hrv_balance??null,restingHR:o?.contributors?.resting_heart_rate??null,date:o?.day??i?.day??new Date().toISOString().split("T")[0]}}},$="https://api.prod.whoop.com/developer",Y=class{constructor(){this.name="whoop",this.displayName="WHOOP"}normalizeHrv(t){return Math.min(100,Math.max(0,Math.round(t/1.2)))}async fetchBiometricData(t){let e=new Date().toISOString().split("T")[0],[i,o]=await Promise.all([this.fetchRecovery(t),this.fetchSleep(t)]),a=null,n=null,r=null;i?.score&&(a=i.score.recovery_score,n=this.normalizeHrv(i.score.hrv_rmssd_milli),r=i.score.resting_heart_rate);let s=null;return o?.score&&(s=o.score.sleep_performance_percentage),{sleepScore:s,readinessScore:a,hrvBalance:n,restingHR:r,date:e}}async validateToken(t){try{return(await fetch(`${$}/v1/user/profile/basic`,{headers:{Authorization:`Bearer ${t}`}})).ok}catch{return!1}}async fetchRecovery(t){try{let e=await fetch(`${$}/v1/recovery?limit=1`,{headers:{Authorization:`Bearer ${t}`}});return e.ok?(await e.json()).records[0]||null:(console.error("WHOOP recovery fetch failed:",e.status),null)}catch(e){return console.error("WHOOP recovery fetch error:",e),null}}async fetchSleep(t){try{let e=await fetch(`${$}/v1/activity/sleep?limit=1`,{headers:{Authorization:`Bearer ${t}`}});return e.ok?(await e.json()).records[0]||null:(console.error("WHOOP sleep fetch failed:",e.status),null)}catch(e){return console.error("WHOOP sleep fetch error:",e),null}}};var Z={basketball:{train_hard:{todayAdvice:"Great day for full-court games and explosive plays",intensityTips:["Go all out on fast breaks","Full-intensity scrimmages OK","Practice shots at game speed"],warmup:"Dynamic stretches + shooting (10 min)",duration:"60-90 min"},train_light:{todayAdvice:"Stick to shooting drills and half-court",intensityTips:["Focus on shooting form","Half-court 3v3 max","Avoid full sprints"],warmup:"Extended warm-up (15 min)",duration:"30-45 min",cautionNotes:["Skip fast breaks","Sub out frequently"]},rest:{todayAdvice:"Skip basketball today",intensityTips:["Light shooting only","No running or jumping"],warmup:"N/A",duration:"Rest day",cautionNotes:["High injury risk if you play tired"]}},running:{train_hard:{todayAdvice:"Great day for tempo or intervals",intensityTips:["Tempo run at threshold","400m/800m repeats","Hill sprints OK"],warmup:"Easy jog + stretches (10 min)",duration:"45-75 min"},train_light:{todayAdvice:"Easy recovery run only",intensityTips:["Conversational pace","Zone 2 heart rate","Walk breaks fine"],warmup:"Walk 5 min first",duration:"20-30 min",cautionNotes:["No speed work"]},rest:{todayAdvice:"Walking only today",intensityTips:["20-30 min walk max","Foam rolling"],warmup:"N/A",duration:"Rest day",cautionNotes:["Running fatigued = injury risk"]}},cycling:{train_hard:{todayAdvice:"Push the watts - intervals or climbs",intensityTips:["VO2max intervals","Hill repeats","Sprint training"],warmup:"Easy spin 10-15 min",duration:"60-120 min"},train_light:{todayAdvice:"Zone 2 recovery ride",intensityTips:["Flat routes","High cadence (90+ rpm)","Easy effort"],warmup:"Easy spin 5 min",duration:"30-45 min",cautionNotes:["Avoid hills"]},rest:{todayAdvice:"Stay off the bike",intensityTips:["Stretching","Walk instead"],warmup:"N/A",duration:"Rest day"}},weightlifting:{train_hard:{todayAdvice:"Heavy day - go for PRs",intensityTips:["85-100% 1RM","Compound lifts","3-6 reps"],warmup:"10 min cardio + empty bar",duration:"60-90 min"},train_light:{todayAdvice:"Deload - technique focus",intensityTips:["50-65% 1RM","10-15 reps","Machines OK"],warmup:"Extended warm-up (15 min)",duration:"30-45 min",cautionNotes:["No PRs","No heavy compounds"]},rest:{todayAdvice:"Skip the gym",intensityTips:["Light stretching","Foam rolling"],warmup:"N/A",duration:"Rest day",cautionNotes:["Lifting tired = poor gains"]}},crossfit:{train_hard:{todayAdvice:"Full WOD - send it",intensityTips:["RX weights","Competition intensity"],warmup:"Class warm-up + mobility",duration:"60-75 min"},train_light:{todayAdvice:"Scale significantly",intensityTips:["50-60% RX","Focus on quality"],warmup:"Extended warm-up",duration:"45 min max",cautionNotes:["Skip the leaderboard"]},rest:{todayAdvice:"Skip CrossFit",intensityTips:["Light mobility only"],warmup:"N/A",duration:"Rest day",cautionNotes:["High injury risk when tired"]}},swimming:{train_hard:{todayAdvice:"Intervals and sprints",intensityTips:["Sprint sets (50m/100m)","Threshold intervals"],warmup:"400m easy + drills",duration:"60-90 min"},train_light:{todayAdvice:"Easy laps - technique",intensityTips:["Slow pace","Drill work"],warmup:"200m easy",duration:"30-45 min",cautionNotes:["No sprints"]},rest:{todayAdvice:"Pool day off",intensityTips:["Stretching","Sauna/hot tub OK"],warmup:"N/A",duration:"Rest day"}},yoga:{train_hard:{todayAdvice:"Power or Vinyasa flow",intensityTips:["Challenging sequences","Inversions OK"],warmup:"Sun salutations",duration:"60-90 min"},train_light:{todayAdvice:"Gentle or Yin yoga",intensityTips:["Restorative poses","Focus on breath"],warmup:"Seated breathing",duration:"30-60 min"},rest:{todayAdvice:"Restorative only",intensityTips:["Savasana","Meditation"],warmup:"N/A",duration:"20-30 min"}},soccer:{train_hard:{todayAdvice:"Full match intensity OK",intensityTips:["11v11 or 7v7","Sprint drills"],warmup:"Rondos + stretches (15 min)",duration:"90 min match"},train_light:{todayAdvice:"Technical work only",intensityTips:["Passing drills","No sprints"],warmup:"Extended warm-up",duration:"30-45 min",cautionNotes:["Skip the match"]},rest:{todayAdvice:"No soccer today",intensityTips:["Light juggling max","Stretching"],warmup:"N/A",duration:"Rest day",cautionNotes:["Soft tissue injury risk"]}},tennis:{train_hard:{todayAdvice:"Match play or intense drills",intensityTips:["Competitive sets","Full power serves"],warmup:"Mini-tennis + stretches (10 min)",duration:"60-120 min"},train_light:{todayAdvice:"Rally practice at 70%",intensityTips:["Groundstroke technique","Light serves"],warmup:"Extended warm-up",duration:"30-45 min",cautionNotes:["Easy on serve"]},rest:{todayAdvice:"Off court today",intensityTips:["Shoulder mobility","Stretching"],warmup:"N/A",duration:"Rest day",cautionNotes:["Tennis elbow risk"]}},golf:{train_hard:{todayAdvice:"Full round or range session",intensityTips:["18 holes walking","Full swing driver"],warmup:"Stretches + putting (15 min)",duration:"4 hrs or 60-90 min range"},train_light:{todayAdvice:"Short game focus",intensityTips:["Putting/chipping only","9 holes with cart"],warmup:"Easy stretches",duration:"30-60 min",cautionNotes:["Skip driver"]},rest:{todayAdvice:"Skip golf",intensityTips:["Putting mat at home","Back stretches"],warmup:"N/A",duration:"Rest day",cautionNotes:["Low back risk"]}},hiking:{train_hard:{todayAdvice:"Challenging trail OK",intensityTips:["Steep elevation","Heavy pack OK"],warmup:"5-10 min easy walking",duration:"3-6 hours"},train_light:{todayAdvice:"Easy trail",intensityTips:["Flat/gentle incline","Light pack"],warmup:"Start slow",duration:"1-2 hours",cautionNotes:["Avoid technical trails"]},rest:{todayAdvice:"Short walk only",intensityTips:["Flat neighborhood walk","20-30 min"],warmup:"N/A",duration:"Rest day"}},climbing:{train_hard:{todayAdvice:"Project your limit grades",intensityTips:["Hard projects","Campus board OK"],warmup:"Easy climbs + fingers (20 min)",duration:"2-3 hours"},train_light:{todayAdvice:"Volume at easy grades",intensityTips:["2-3 grades below max","No crimps"],warmup:"Extended warm-up (25 min)",duration:"1-1.5 hours",cautionNotes:["No limit bouldering"]},rest:{todayAdvice:"Rest those tendons",intensityTips:["Antagonist exercises","Finger stretches"],warmup:"N/A",duration:"Rest day",cautionNotes:["Finger injuries when tired"]}},martial_arts:{train_hard:{todayAdvice:"Full sparring OK",intensityTips:["Live sparring","Full-speed drills"],warmup:"Full warm-up + shadow (15 min)",duration:"60-90 min"},train_light:{todayAdvice:"Technical drilling only",intensityTips:["Slow positional work","Light flow"],warmup:"Extended movement prep",duration:"45-60 min",cautionNotes:["No hard sparring","Tap early"]},rest:{todayAdvice:"Off the mats",intensityTips:["Watch instructionals","Light stretching"],warmup:"N/A",duration:"Rest day",cautionNotes:["Injuries happen when exhausted"]}},general:{train_hard:{todayAdvice:"Full intensity",intensityTips:["Push yourself","High effort"],warmup:"10-15 min",duration:"60-90 min"},train_light:{todayAdvice:"Light movement",intensityTips:["Easy effort","Zone 2"],warmup:"10 min",duration:"30-45 min",cautionNotes:["Don't push hard"]},rest:{todayAdvice:"Rest and recover",intensityTips:["Walking","Stretching"],warmup:"N/A",duration:"Rest day"}}},X={basketball:"Basketball",running:"Running",cycling:"Cycling",weightlifting:"Weightlifting",crossfit:"CrossFit",swimming:"Swimming",yoga:"Yoga",soccer:"Soccer",tennis:"Tennis",golf:"Golf",hiking:"Hiking",climbing:"Climbing",martial_arts:"Martial Arts",general:"General"};function J(t){let e=t.readinessScore??t.sleepScore??50;if(t.hrvBalance!==null){let i=(t.hrvBalance-50)*.1;e=Math.round(e+i)}return Math.max(0,Math.min(100,e))}function Q(t){return t.hrvBalance===null?"unknown":t.hrvBalance>=60?"above_baseline":t.hrvBalance>=40?"normal":"below_baseline"}function ee(t){if(t.hrvBalance===null)return"N/A";let e=t.hrvBalance-50;return e>0?`+${e}%`:e<0?`${e}%`:"baseline"}function te(t){return t===null?"N/A":t>=85?"Excellent":t>=70?"Good":t>=50?"Fair":"Low"}function N(t,e){let i=Z[t][e];return{sport:t,displayName:X[t],...i}}function _(t,e){let i=[];if(t.readinessScore!==null&&(t.readinessScore>=85?i.push(`Readiness ${t.readinessScore} - excellent`):t.readinessScore>=70?i.push(`Readiness ${t.readinessScore} - good`):t.readinessScore>=50?i.push(`Readiness ${t.readinessScore} - moderate`):i.push(`Readiness ${t.readinessScore} - low`)),t.hrvBalance!==null){let o=t.hrvBalance-50;o>=10?i.push(`HRV ${o}% above baseline`):o>=0?i.push("HRV at baseline"):i.push(`HRV ${Math.abs(o)}% below baseline`)}return t.sleepScore!==null&&(t.sleepScore>=70?i.push(`Sleep ${t.sleepScore} - adequate`):i.push(`Sleep ${t.sleepScore} - needs work`)),i}function C(t,e){let i=J(t),o=Q(t),a={readiness:{value:t.readinessScore,status:te(t.readinessScore)},hrv:{value:t.hrvBalance,trend:ee(t)},sleep:{value:t.sleepScore,hours:void 0}};return i>=70&&(o==="above_baseline"||o==="normal")?{verdict:"train_hard",confidence:Math.min(95,i),emoji:"\u{1F7E2}",headline:"TRAIN HARD",subheadline:"Your body is ready for intense work",recommendations:["Heavy lifting - go for PRs","HIIT / intervals","Competitive sports"],avoidList:[],recoveryRisk:"Low - you're recovered",tomorrowOutlook:"Should stay good with proper sleep",dataSummary:a,reasoning:_(t,"train_hard"),intensityGuide:{cardio:"Zone 4-5, HR 160-185 bpm",weights:"85-100% 1RM, 3-6 reps",duration:"60-90 min",rpe:"8-10 RPE"},sportGuide:e?N(e,"train_hard"):void 0}:i>=50||i>=40&&o!=="below_baseline"?{verdict:"train_light",confidence:Math.min(85,i+10),emoji:"\u{1F7E1}",headline:"TRAIN LIGHT",subheadline:"Move your body, but don't push it",recommendations:["Zone 2 cardio (easy pace)","Light weights, more reps","Yoga or stretching"],avoidList:["Heavy lifting","HIIT","PRs"],maxHeartRate:140,suggestedZone:"Zone 2",recoveryRisk:"Moderate - hard training risks setback",tomorrowOutlook:"Better if you rest today",dataSummary:a,reasoning:_(t,"train_light"),intensityGuide:{cardio:"Zone 2, HR 120-140 bpm",weights:"50-65% 1RM, 12-15 reps",duration:"30-45 min",rpe:"4-6 RPE"},sportGuide:e?N(e,"train_light"):void 0}:{verdict:"rest",confidence:Math.min(90,100-i),emoji:"\u{1F534}",headline:"REST DAY",subheadline:"Your body needs recovery",recommendations:["Walking","Gentle stretching","Extra sleep"],avoidList:["All intense exercise"],recoveryRisk:"High if you train - expect 2-3 day forced recovery",tomorrowOutlook:"Big improvement likely with rest",dataSummary:a,reasoning:_(t,"rest"),intensityGuide:{cardio:"Zone 1 only, HR under 110 bpm",weights:"None recommended",duration:"20-30 min max",rpe:"1-3 RPE"},sportGuide:e?N(e,"rest"):void 0}}function ie(t){return t===null?"N/A":t>=85?"Excellent":t>=70?"Good":t>=50?"Fair":"Low"}function oe(t){if(t===null)return"N/A";let e=t-50;return e>0?`+${e}%`:e<0?`${e}%`:"baseline"}function re(t){return t===null?0:t-50}function x(t,e){let i=re(t.hrvBalance),o=t.sleepScore??50,a=t.readinessScore??50,n=3,r=[];i<-15?(n-=1,r.push(`HRV ${i}% below baseline - limit reduced`)):i>=10?r.push("HRV above baseline - body is recovered"):r.push("HRV at baseline"),o<60?(n-=1,r.push(`Sleep score ${o} - poor recovery`)):o<70?r.push(`Sleep score ${o} - moderate`):r.push(`Sleep score ${o} - adequate`),a<50?(n-=1,r.push(`Readiness ${a} - body stressed`)):a>=70&&r.push(`Readiness ${a} - good condition`),e&&e.logs.length>0&&e.logs.some(p=>{let f=Math.floor((Date.now()-p.timestamp.getTime())/864e5);return p.amount>=4&&f<3})&&(n-=1,r.push("Recent heavy drinking - still recovering")),n=Math.max(1,n);let s=[];for(let m=1;m<=5;m++){let p,f,b,E=i<-10?1.3:i>10?.8:1;if(m<=n)p=`-${Math.round(5*m*E)}%`,f="Normal tomorrow",b="Minimal";else if(m<=n+1)p=`-${Math.round(12*m*E*.8)}%`,f="Afternoon recovery",b="Morning fatigue";else{let H=Math.min(3,Math.ceil((m-n)/2));p=`-${Math.round(18*m*E*.6)}%`,f=`${H} day${H>1?"s":""} recovery`,b="Significant fatigue"}s.push({drinks:m,hrvDrop:p,recoveryTime:f,fatigue:b})}let l=[];l.push("Alternate with water between drinks"),o<70&&l.push("Sleep deficit makes alcohol hit harder"),i<-10&&l.push("Your body is already stressed - go easy"),l.push("Eat before/during drinking to slow absorption");let u,d,c,y;return n>=3?(u="green",d="\u{1F7E2}",c="good night to drink",y="your body can handle moderate drinking tonight"):n>=2?(u="yellow",d="\u{1F7E1}",c="light drinks only",y="your body needs some recovery - keep it light"):(u="red",d="\u{1F534}",c="maybe skip it",y="your body's already stressed - not a great night for drinking"),{verdict:u,greenLimit:n,yellowLimit:n+1,redThreshold:n+2,emoji:d,headline:c,subheadline:y,impacts:s,tips:l,dataSummary:{readiness:{value:t.readinessScore,status:ie(t.readinessScore)},hrv:{value:t.hrvBalance,trend:oe(t.hrvBalance)},sleep:{value:t.sleepScore}},reasoning:r}}var ne=60,ae=70,se=3,le=4,ce={A:{emoji:"\u{1F9E0}",headline:"IT'S YOUR BODY, NOT YOUR MIND",subheadline:"Your low mood reflects your physical state.",explanation:`Your recovery metrics are low, and you're feeling down.
This is NOT laziness, weakness, or a character flaw.
Your nervous system is depleted - mood follows.`,recommendations:["Don't blame yourself for feeling low","Rest is the priority, not productivity","Avoid difficult decisions today","Light movement if anything (walk, stretch)","Early bedtime tonight"],isPhysiological:!0},B:{emoji:"\u{1F914}",headline:"BODY IS FINE - LOOK ELSEWHERE",subheadline:"Your physical recovery looks good.",explanation:`Your body metrics are healthy, but mood is low.
This suggests external factors may be involved:
- Work stress, relationships, or life circumstances
- Situational challenges
- This is okay - external ups and downs are normal.`,recommendations:["Your body can handle some challenge today","Consider what's weighing on you","Talk to someone you trust","Journaling might help clarify thoughts","Light exercise could boost mood"],isPhysiological:!1},C:{emoji:"\u26A0\uFE0F",headline:"BODY NEEDS RECOVERY",subheadline:"You feel good, but your body is stressed.",explanation:`You're feeling okay, but your recovery metrics are low.
This is a warning: your good mood may be masking fatigue.
Listen to your body's signals, not just your mind.`,recommendations:["Don't overcommit based on how you feel","Your body needs rest even if mind says go","Avoid intense workouts today","Watch for energy crash later","Prioritize sleep tonight"],isPhysiological:!0},D:{emoji:"\u{1F680}",headline:"GREEN LIGHT - GO FOR IT",subheadline:"Body and mind are aligned and ready.",explanation:`Your recovery is good and you're feeling positive.
This is the ideal state for challenging tasks.
Make the most of this alignment!`,recommendations:["Great day for challenging tasks","Tackle that hard workout","Make important decisions","Push your limits a bit","Enjoy the momentum!"],isPhysiological:!1}};function I(t){return t===null?"moderate":t<ne?"low":t>=ae?"high":"moderate"}function L(t){return t<se?"low":t>=le?"high":"moderate"}function de(t,e){let i=t==="low",o=e==="low";return i&&o?"A":!i&&o?"B":i&&!o?"C":"D"}function ue(t,e){let i=I(t.readinessScore),o=L(e),a=de(i,o);return{scenario:a,...ce[a]}}function he(t,e){if(t.length!==e.length||t.length<3)return null;let i=t.length,o=t.reduce((d,c)=>d+c,0),a=e.reduce((d,c)=>d+c,0),n=t.reduce((d,c,y)=>d+c*e[y],0),r=t.reduce((d,c)=>d+c*c,0),s=e.reduce((d,c)=>d+c*c,0),l=i*n-o*a,u=Math.sqrt((i*r-o*o)*(i*s-a*a));return u===0?null:l/u}function me(t,e){let i=Math.min(t.length,e.length);if(i<5)return{correlation:null,dataPoints:i,trend:"insufficient_data",summary:`Not enough data yet (${i}/5 days needed)`,insight:"Log your mood for 5+ days to see your personal patterns."};let o=t.slice(-i).map(u=>u.score),a=e.slice(-i),n=he(a,o),r,s,l;return n===null?(r="insufficient_data",s="Unable to calculate correlation",l="More varied data points needed."):n>.5?(r="positive",s=`Strong correlation (r=${n.toFixed(2)})`,l="Your mood strongly tracks your recovery. When tired, expect lower mood - it's physiological, not personal."):n>.2?(r="positive",s=`Moderate correlation (r=${n.toFixed(2)})`,l="Your mood is somewhat linked to recovery. Physical state matters, but other factors too."):n<-.2?(r="negative",s=`Inverse correlation (r=${n.toFixed(2)})`,l="Interesting: your mood tends to move opposite to recovery. External factors may dominate."):(r="neutral",s=`Weak correlation (r=${n.toFixed(2)})`,l="Your mood seems independent of physical recovery. External factors likely play a bigger role."),{correlation:n,dataPoints:i,trend:r,summary:s,insight:l}}function F(t,e,i,o){let a=ue(t,e),n=I(t.readinessScore),r=L(e),s;return i&&o&&(s=me(i,o)),{scenario:a.scenario,attribution:a,dataSummary:{readiness:t.readinessScore,recoveryStatus:n,moodScore:e,moodStatus:r},moodHistory:s}}var ye={sleepScore:72,readinessScore:65,hrvBalance:45,restingHR:58,date:new Date().toISOString().split("T")[0]};var B={oura:new M,whoop:new Y};async function k(t,e="oura"){let i=B[e];if(!i)throw new Error(`Unknown provider: ${e}`);return i.fetchBiometricData(t)}async function j(t,e="oura"){let i=B[e];return i?i.validateToken(t):!1}function S(t){return B[t]?.displayName||t.toUpperCase()}var v=require("obsidian"),W={provider:"oura",token:"",autoInsertOnDailyNote:!1,dailyNoteFormat:"YYYY-MM-DD"},D=class extends g.PluginSettingTab{plugin;constructor(e,i){super(e,i),this.plugin=i}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"P360 Settings"}),new g.Setting(e).setName("Device").setDesc("Select your wearable device").addDropdown(n=>n.addOption("oura","Oura Ring").addOption("whoop","WHOOP").setValue(this.plugin.settings.provider).onChange(async r=>{this.plugin.settings.provider=r,await this.plugin.saveSettings()})),new g.Setting(e).setName("Access Token").setDesc("Your device access token").addText(n=>n.setPlaceholder("Enter your token").setValue(this.plugin.settings.token).onChange(async r=>{this.plugin.settings.token=r,await this.plugin.saveSettings()})),new g.Setting(e).setName("Validate Connection").setDesc("Test if your token is working").addButton(n=>n.setButtonText("Test Connection").onClick(async()=>{let{token:r,provider:s}=this.plugin.settings;if(!r){new v.Notice("Please enter a token first");return}n.setButtonText("Testing..."),n.setDisabled(!0);try{await j(r,s)?new v.Notice(`\u2705 ${S(s)} connected successfully!`):new v.Notice("\u274C Token validation failed. Please check your token.")}catch(l){new v.Notice(`\u274C Error: ${l}`)}finally{n.setButtonText("Test Connection"),n.setDisabled(!1)}})),e.createEl("h3",{text:"Daily Notes Integration"}),new g.Setting(e).setName("Auto-insert in Daily Notes").setDesc("Automatically add biometric summary when creating daily notes").addToggle(n=>n.setValue(this.plugin.settings.autoInsertOnDailyNote).onChange(async r=>{this.plugin.settings.autoInsertOnDailyNote=r,await this.plugin.saveSettings()})),e.createEl("h3",{text:"How to get your token"});let i=e.createEl("div",{cls:"setting-item-description"});i.createEl("p",{text:"Oura Ring:"});let o=i.createEl("ol");o.createEl("li",{text:"Go to cloud.ouraring.com"}),o.createEl("li",{text:"Navigate to Personal Access Tokens"}),o.createEl("li",{text:"Create a new token and copy it"}),i.createEl("p",{text:"WHOOP:"});let a=i.createEl("ol");a.createEl("li",{text:"Go to developer.whoop.com"}),a.createEl("li",{text:"Create an application"}),a.createEl("li",{text:"Get your access token"})}};var R=require("obsidian");var w="p360-mood-view",T=class extends R.ItemView{plugin;moodScore=null;biometricData=null;moodDecision=null;constructor(e,i){super(e),this.plugin=i}getViewType(){return w}getDisplayText(){return"P360 Mood"}getIcon(){return"smile"}async onOpen(){await this.refresh()}async refresh(){let e=this.containerEl.children[1];e.empty(),e.addClass("p360-mood-widget");let i=e.createDiv({cls:"p360-mood-header"}),o=i.createSpan();(0,R.setIcon)(o,"smile"),i.createEl("h4",{text:"How are you feeling?"});let a=e.createDiv({cls:"p360-mood-scores"}),n=["\u{1F62B}","\u{1F615}","\u{1F610}","\u{1F642}","\u{1F60A}"];for(let r=1;r<=5;r++){let s=a.createEl("button",{cls:"p360-mood-btn",text:n[r-1]});s.setAttribute("data-score",String(r)),this.moodScore===r&&s.addClass("selected"),s.addEventListener("click",async()=>{this.moodScore=r,await this.updateMoodAnalysis(),await this.refresh()})}if(this.biometricData){let r=e.createDiv({cls:"p360-status"});this.createStatusRow(r,"Readiness",`${this.biometricData.readinessScore??"?"}/100`),this.createStatusRow(r,"HRV",this.getHrvStatus(this.biometricData.hrvBalance)),this.createStatusRow(r,"Sleep",`${this.biometricData.sleepScore??"?"}/100`)}else this.plugin.settings.token?(e.createDiv({cls:"p360-status"}).createEl("p",{text:"Loading biometric data..."}),this.loadBiometricData()):e.createDiv({cls:"p360-status"}).createEl("p",{text:"Configure your device in settings to see biometric data."});if(this.moodDecision){let r=e.createDiv({cls:"p360-insight"}),{attribution:s}=this.moodDecision;r.createDiv({cls:"p360-insight-title",text:`${s.emoji} ${s.headline}`}),r.createDiv({cls:"p360-insight-text",text:s.subheadline});let l=r.createEl("ul");s.recommendations.slice(0,3).forEach(u=>{l.createEl("li",{text:u})})}}createStatusRow(e,i,o){let a=e.createDiv({cls:"p360-status-row"});a.createSpan({cls:"p360-status-label",text:i}),a.createSpan({cls:"p360-status-value",text:o})}getHrvStatus(e){if(e===null)return"N/A";let i=e-50;return i>=10?`+${i}% above baseline`:i<=-10?`${i}% below baseline`:"At baseline"}async loadBiometricData(){let{token:e,provider:i}=this.plugin.settings;if(e)try{this.biometricData=await k(e,i),this.moodScore&&await this.updateMoodAnalysis(),await this.refresh()}catch(o){console.error("Failed to load biometric data:",o)}}async updateMoodAnalysis(){!this.moodScore||!this.biometricData||(this.moodDecision=F(this.biometricData,this.moodScore))}async onClose(){}};var A=class extends h.Plugin{settings;async onload(){await this.loadSettings(),this.addSettingTab(new D(this.app,this)),this.registerView(w,e=>new T(e,this)),this.addRibbonIcon("activity","P360 Daily Check",async()=>{await this.insertDailyCheck()}),this.addCommand({id:"p360-daily-check",name:"Insert Daily Check",editorCallback:async e=>{await this.insertDailyCheckAtCursor(e)}}),this.addCommand({id:"p360-workout",name:"Insert Workout Recommendation",editorCallback:async e=>{await this.insertWorkout(e)}}),this.addCommand({id:"p360-drink",name:"Insert Drink Guide",editorCallback:async e=>{await this.insertDrink(e)}}),this.addCommand({id:"p360-mood",name:"Open Mood Widget",callback:async()=>{await this.activateMoodView()}}),this.addCommand({id:"p360-refresh",name:"Refresh Biometric Data",callback:async()=>{await this.refreshData()}}),console.log("P360 plugin loaded")}onunload(){console.log("P360 plugin unloaded")}async loadSettings(){this.settings=Object.assign({},W,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async getBiometricData(){let{token:e,provider:i}=this.settings;if(!e)return new h.Notice("Please configure your device token in P360 settings"),null;try{return await k(e,i)}catch(o){return console.error("Failed to fetch biometric data:",o),new h.Notice("Failed to fetch biometric data. Check your token."),null}}async insertDailyCheck(){let e=this.app.workspace.getActiveViewOfType(h.MarkdownView);if(!e){new h.Notice("Please open a note first");return}await this.insertDailyCheckAtCursor(e.editor)}async insertDailyCheckAtCursor(e){let i=await this.getBiometricData();if(!i)return;let{provider:o}=this.settings,a=S(o),n=C(i),r=x(i),l=`
## P360 Daily Check
*${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})} | ${a}*

### Biometrics
| Metric | Value | Status |
|--------|-------|--------|
| Readiness | ${i.readinessScore??"?"}/100 | ${this.getStatusEmoji(i.readinessScore)} |
| Sleep | ${i.sleepScore??"?"}/100 | ${this.getStatusEmoji(i.sleepScore)} |
| HRV | ${this.formatHrv(i.hrvBalance)} | ${this.getHrvStatusEmoji(i.hrvBalance)} |
| RHR | ${i.restingHR??"?"} bpm | |

### Workout
> ${n.emoji} **${n.headline}**
> ${n.subheadline}

${n.reasoning.map(u=>`- ${u}`).join(`
`)}

**Intensity Guide:**
- Cardio: ${n.intensityGuide.cardio||"N/A"}
- Weights: ${n.intensityGuide.weights||"N/A"}
- RPE: ${n.intensityGuide.rpe||"N/A"}

### Drink Limit
> ${r.emoji} **${r.headline}**

| Drinks | Impact |
|--------|--------|
| ${r.greenLimit} | ${r.impacts[r.greenLimit-1]?.recoveryTime||"OK"} |
| ${r.yellowLimit} | ${r.impacts[r.yellowLimit-1]?.recoveryTime||"Caution"} |
| ${r.redThreshold}+ | ${r.impacts[Math.min(r.redThreshold,4)]?.recoveryTime||"Recovery needed"} |

---
*Generated by P360*
`;e.replaceSelection(l.trim()),new h.Notice("Daily check inserted!")}async insertWorkout(e){let i=await this.getBiometricData();if(!i)return;let o=C(i),a=`
> [!${this.getCalloutType(o.verdict)}] ${o.emoji} ${o.headline}
> ${o.subheadline}
>
> **Readiness:** ${i.readinessScore??"?"}/100 | **HRV:** ${this.formatHrv(i.hrvBalance)} | **Sleep:** ${i.sleepScore??"?"}/100
>
> ${o.reasoning.map(n=>`- ${n}`).join(`
> `)}
`;e.replaceSelection(a.trim()),new h.Notice("Workout recommendation inserted!")}async insertDrink(e){let i=await this.getBiometricData();if(!i)return;let o=x(i),a=`
> [!${this.getCalloutType(o.verdict)}] ${o.emoji} ${o.headline}
> ${o.subheadline}
>
> **Tonight's Limits:**
> - \u{1F7E2} ${o.greenLimit} drinks: ${o.impacts[o.greenLimit-1]?.recoveryTime||"OK"}
> - \u{1F7E1} ${o.yellowLimit} drinks: ${o.impacts[o.yellowLimit-1]?.recoveryTime||"Caution"}
> - \u{1F534} ${o.redThreshold}+ drinks: ${o.impacts[Math.min(o.redThreshold,4)]?.recoveryTime||"Recovery needed"}
`;e.replaceSelection(a.trim()),new h.Notice("Drink guide inserted!")}async activateMoodView(){let e=this.app.workspace.getLeavesOfType(w);if(e.length===0){let i=this.app.workspace.getRightLeaf(!1);i&&(await i.setViewState({type:w,active:!0}),this.app.workspace.revealLeaf(i))}else this.app.workspace.revealLeaf(e[0])}async refreshData(){let e=await this.getBiometricData();e&&new h.Notice(`Data refreshed: Readiness ${e.readinessScore??"?"}, Sleep ${e.sleepScore??"?"}`)}getStatusEmoji(e){return e===null?"\u2753":e>=85?"\u{1F7E2}":e>=70?"\u{1F7E1}":e>=50?"\u{1F7E0}":"\u{1F534}"}getHrvStatusEmoji(e){if(e===null)return"\u2753";let i=e-50;return i>=10?"\u{1F7E2}":i<=-10?"\u{1F534}":"\u{1F7E1}"}formatHrv(e){if(e===null)return"N/A";let i=e-50;return i>0?`+${i}%`:`${i}%`}getCalloutType(e){switch(e){case"train_hard":case"good":return"success";case"moderate":case"train_light":return"warning";case"rest":case"skip":return"danger";default:return"info"}}};
